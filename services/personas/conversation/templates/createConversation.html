{% extends 'base.html' %}

{% block title %}Create Conversation{% endblock %}

{% block head %}
<script>
    function addHero() {
        var dropdown = document.getElementById('heroesDropdown');
        var selectedHero = dropdown.options[dropdown.selectedIndex].value;

        var heroDiv = document.createElement('div');
        heroDiv.classList.add('hero-list-item');
        heroDiv.innerText = selectedHero;

        var removeButton = document.createElement('button');
        removeButton.type = 'button';
        removeButton.innerText = 'Remove';
        removeButton.onclick = function() {
            heroDiv.remove();
            updateHiddenInputs();
        };

        heroDiv.appendChild(removeButton);
        document.getElementById('selectedHeroes').appendChild(heroDiv);
        updateHiddenInputs();
    }

    function addStyle() {
        var selectedStyle = document.getElementById("styleSelect").value;
        var styleDiv = document.createElement('div');
        styleDiv.classList.add('style-list-item');
        styleDiv.innerText = selectedStyle;

        var removeButton = document.createElement('button');
        removeButton.type = 'button';
        removeButton.innerText = 'Remove';
        removeButton.onclick = function() {
            styleDiv.remove();
            updateHiddenInputs();
        };

        styleDiv.appendChild(removeButton);
        document.getElementById('selectedStyles').appendChild(styleDiv);
        updateHiddenInputs();
    }

    function updateHiddenInputs() {
        var selectedHeroes = Array.from(document.getElementById('selectedHeroes').children)
            .map(div => div.textContent.replace('Remove', '').trim());
        document.getElementById('hiddenSelectedHeroes').value = JSON.stringify(selectedHeroes);

        var selectedStyles = Array.from(document.getElementById('selectedStyles').children)
            .map(div => div.textContent.replace('Remove', '').trim());
        document.getElementById('hiddenSelectedStyles').value = JSON.stringify(selectedStyles);
    }
</script>
{% endblock %}

{% block content %}
<form action="/sendConversation" method="post">
    <label for="heroesDropdown">Select the Heroes that should be in the story:</label><br>
    <select id="heroesDropdown">
        {% for name in hero_names %}
        <option value="{{ name }}">{{ name }}</option>
        {% endfor %}
    </select>
    <button type="button" onclick="addHero()">Add Hero</button><br><br>

    <label>Selected Heroes:</label><br>
    <div id="selectedHeroes">
        <!-- Dynamically added heroes will go here -->
    </div><br>

    <label for="styleSelect">The Style the story should be in (select one or more):</label><br>
    <select id="styleSelect">
        <option value="Funny">Funny</option>
        <option value="Realistic">Realistic</option>
        <option value="Dark">Dark</option>
        <option value="Fantastical">Fantastical</option>
        <option value="Action-Packed">Action-Packed</option>
    </select>
    <button type="button" onclick="addStyle()">Add Style</button><br><br>

    <label>Selected Styles:</label><br>
    <div id="selectedStyles">
        <!-- Dynamically added styles will go here -->
    </div><br>

    <label for="setting">Setting where the story takes place:</label><br>
    <input type="text" id="setting" name="setting"><br><br>

    <!-- Hidden inputs for selected heroes and styles -->
    <input type="hidden" name="selectedHeroes" id="hiddenSelectedHeroes">
    <input type="hidden" name="selectedStyles" id="hiddenSelectedStyles">

    <input type="submit" value="Create Story">
</form>
{% endblock %}
